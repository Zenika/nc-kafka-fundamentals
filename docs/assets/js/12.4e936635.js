(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{367:function(t,a,s){"use strict";s.r(a);var e=s(44),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"lab04-schema-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lab04-schema-registry"}},[t._v("#")]),t._v(" Lab04 - Schema Registry")]),t._v(" "),s("h2",{attrs:{id:"rappel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rappel"}},[t._v("#")]),t._v(" Rappel")]),t._v(" "),s("p",{staticStyle:{"text-align":"center"}},[s("img",{attrs:{src:"lab04.png",alt:"lab04"}})]),t._v(" "),s("p",{staticStyle:{"text-align":"center"}},[s("img",{attrs:{src:"lab04.bis.png",alt:"lab04-bis"}})]),t._v(" "),s("h2",{attrs:{id:"le-schema-registry-de-confluent"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#le-schema-registry-de-confluent"}},[t._v("#")]),t._v(" Le Schema Registry de Confluent")]),t._v(" "),s("p",[t._v("La "),s("strong",[t._v("Schema Registry")]),t._v(" est un service permettant de garantir la consistence des objets qui circulent au sein du cluster.\n"),s("img",{attrs:{src:"schema-registry-and-kafka.png",alt:"schema-registry-and-kafka.png"}})]),t._v(" "),s("p",[t._v("La Schema Registry est sous licence "),s("code",[t._v("Confluent Community License")]),t._v(".")]),t._v(" "),s("p",[t._v("Le repository Github: "),s("a",{attrs:{href:"https://github.com/confluentinc/schema-registry",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/confluentinc/schema-registry"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("La documentation officielle de\nconfluent: "),s("a",{attrs:{href:"https://docs.confluent.io/platform/current/schema-registry/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.confluent.io/platform/current/schema-registry/index.html"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"preparer-le-projet-et-le-topic-kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preparer-le-projet-et-le-topic-kafka"}},[t._v("#")]),t._v(" Pr√©parer le projet et le topic Kafka")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("‚ö†Ô∏è Checkout de la branche "),s("code",[t._v("step04")]),t._v(" ‚ö†Ô∏è.")])]),t._v(" "),s("li",[s("p",[t._v("Se placer dans le r√©pertoire "),s("code",[t._v("Lab04-avro")])])]),t._v(" "),s("li",[s("p",[t._v("D√©marrer le conteneur schema-registry.")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker-compose -f docker-compose-schema.yml up -d\n")])])]),s("h3",{attrs:{id:"le-topic-kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#le-topic-kafka"}},[t._v("#")]),t._v(" Le topic Kafka")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Au sein de ce lab nous utilisons "),s("a",{attrs:{href:"https://spring.io/projects/spring-kafka",target:"_blank",rel:"noopener noreferrer"}},[t._v("spring-kafka"),s("OutboundLink")],1),t._v(" pour dialoguer avec Kafka au\nsein de l'√©cosyst√®me Spring Boot.")])]),t._v(" "),s("li",[s("p",[t._v('Spring Kafka fourni des composants qui permettent de vous "faciliter la vie", il permet de cr√©er ais√©ment des topics\nau sein de votre application :\n'),s("a",{attrs:{href:"https://docs.spring.io/spring-kafka/reference/html/#configuring-topics",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.spring.io/spring-kafka/reference/html/#configuring-topics"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("Le bean "),s("code",[t._v("NewTopic")]),t._v(" provoque la cr√©ation du topic sur le broker ; il n'est pas n√©cessaire si le topic existe d√©j√†.")])])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NewTopic")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("schemaAvroTopic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TopicBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("partitions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("‚ö†Ô∏è Spring Kafka utilise l'API admin du cluster pour r√©aliser cette op√©ration de cr√©ation de topic. M√™me si vous\nsp√©cifiez "),s("code",[t._v("KAFKA_AUTO_CREATE_TOPICS_ENABLE: 'false'")]),t._v(", le param√©trage d'un bean "),s("code",[t._v("KafkaAdmin")]),t._v(" permet de manipuler l'API\nadmin.")])]),t._v(" "),s("h2",{attrs:{id:"un-peu-de-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#un-peu-de-code"}},[t._v("#")]),t._v(" Un peu de code")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Apache Avro")]),t._v(" est un framework qui poss√®de un mod√®le de donn√©es de type JSON et offre la capacit√© de s√©rialisation.\nLes donn√©es peuvent √™tre √©galement repr√©sent√©es en tant que JSON ou sous une forme binaire compacte. Avro est\nlivr√© avec un langage de description de sch√©ma tr√®s sophistiqu√© qui permet de d√©crire les donn√©es.")]),t._v(" "),s("ol",[s("li",[t._v("Direct Mapping vers et depuis JSON")]),t._v(" "),s("li",[t._v("Il dispose d'un format tr√®s compact.")]),t._v(" "),s("li",[t._v("C'est tr√®s rapide.")]),t._v(" "),s("li",[t._v("Vous pouvez g√©n√©rer des objets Java pour des √©v√©nements / records Kafka, mais il ne n√©cessite pas de g√©n√©ration\nde code afin que les outils puissent √™tre √©crits de mani√®re g√©n√©rique pour tout flux de donn√©es.")]),t._v(" "),s("li",[t._v("Il dispose d'un langage de sch√©ma riche et extensible d√©fini en JSON.")]),t._v(" "),s("li",[t._v("Il dispose de la meilleure notion de compatibilit√© pour faire √©voluer vos donn√©es/sch√©mas dans le temps.")])])]),t._v(" "),s("li",[s("p",[t._v("Pour plus d'informations sur l'usage\nd'Avro : "),s("a",{attrs:{href:"https://www.confluent.fr/blog/avro-kafka-data/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.confluent.fr/blog/avro-kafka-data/"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("Explorez le d√©coupage projet")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("consumer")])]),t._v(" "),s("li",[s("code",[t._v("producer")])]),t._v(" "),s("li",[s("code",[t._v("src/main/avro")])])])]),t._v(" "),s("li",[s("p",[t._v("Au sein de ce projet "),s("code",[t._v("Lab04-avro")]),t._v(" nous utilisons un plugin maven nous permettant de g√©n√©rer nos entit√©s m√©tiers\nd'√©v√©nements Kafka.")])])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.avro"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("avro-maven-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.10.2"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("executions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("execution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("phase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("process-sources"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("phase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("goals")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("goal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("schema"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("goal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("goals")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("sourceDirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.basedir}/src/main/avro/"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("sourceDirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("outputDirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.basedir}/target/generated-sources/avro"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("outputDirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("execution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("executions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("ul",[s("li",[t._v("Pour g√©n√©rer les entit√©s, il est n√©cessaire d'√©xecuter la phase maven "),s("code",[t._v("compile")]),t._v(" qui appliquera le "),s("code",[t._v("process-sources")]),t._v(".")])]),t._v(" "),s("blockquote",[s("p",[t._v("Se placer dans le bon r√©pertoire "),s("code",[t._v("Lab04-avro")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./mvnw clean compile`\n")])])]),s("ul",[s("li",[s("p",[t._v("Observez les POJO g√©n√©r√©s cf. "),s("code",[t._v("target/generated-sources/avro")])])]),t._v(" "),s("li",[s("p",[t._v("Maintenant vous pouvez utiliser directement des objets java dans votre code, inutile de passer par un "),s("code",[t._v("String")]),t._v(",\nvous pouvez exploiter des objets complexes.")])])]),t._v(" "),s("h3",{attrs:{id:"partie-producer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#partie-producer"}},[t._v("#")]),t._v(" Partie "),s("code",[t._v("Producer")])]),t._v(" "),s("blockquote",[s("p",[t._v("La classe VehiclePositionProducer.java")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProducerFactory")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" producerFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("Et surtout param√©trer des cl√©s complexes pour vos "),s("code",[t._v("Record")]),t._v(" :")])]),t._v(" "),s("blockquote",[s("p",[t._v("La classe Subscriber.java")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionValue")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPositionValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPayload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionKey")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProducerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProducerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("kafkaTopic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("record")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"partie-consummer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#partie-consummer"}},[t._v("#")]),t._v(" Partie "),s("code",[t._v("Consummer")])]),t._v(" "),s("blockquote",[s("p",[t._v("La classe KafkaRestConsumer.java")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Consumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" consumer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kafkaConsumerFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createConsumer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PositionValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"demarrer-votre-application-en-local"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#demarrer-votre-application-en-local"}},[t._v("#")]),t._v(" D√©marrer votre application en local")]),t._v(" "),s("ul",[s("li",[t._v("Il s'agit d'un projet Maven qui dispose d'un wrapper "),s("code",[t._v("mvnw")]),t._v(" et du plugin "),s("code",[t._v("spring-boot-maven-plugin")]),t._v(", vous pouvez\nd√©marrer votre application spring en local √† l'aide de la commande suivante :")])]),t._v(" "),s("blockquote",[s("p",[t._v("Se placer dans le bon r√©pertoire "),s("code",[t._v("Lab04-avro")])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("./mvnw spring-boot:run\n")])])]),s("ul",[s("li",[t._v("Visualiser la consommation des messages sur l'url suivante : "),s("a",{attrs:{href:"http://localhost:8092",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:8092"),s("OutboundLink")],1)])]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("Que voyez-vous sur l'IHM ?")]),t._v(" "),s("li",[t._v("Observez les schemas AKHQ "),s("a",{attrs:{href:"http://localhost:8080/ui/server/schema",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://akhq:8080/"),s("OutboundLink")],1),t._v(" ?")]),t._v(" "),s("li",[t._v("O√π sont stock√©s les sch√©mas ?")])])]),t._v(" "),s("h2",{attrs:{id:"packager-votre-application-avec-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#packager-votre-application-avec-docker"}},[t._v("#")]),t._v(" Packager votre application avec Docker")]),t._v(" "),s("ul",[s("li",[t._v("Pour builder et d√©marrer le conteneur")])]),t._v(" "),s("blockquote",[s("p",[t._v("Se placer dans le bon r√©pertoire "),s("code",[t._v("Lab04-avro")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker build -t vp-avro-producer-consumer "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run --name vp-avro-producer-consumer --network"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tz-kafka-network -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8092")]),t._v(":8092 -d vp-avro-producer-consumer\n")])])]),s("h2",{attrs:{id:"solution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#solution"}},[t._v("#")]),t._v(" Solution")]),t._v(" "),s("p",[t._v("Vous vous doutez que pour disposer des solutions de la "),s("code",[t._v("step04")]),t._v(", il vous suffit deÔ∏è checkout la branche "),s("code",[t._v("step05")]),t._v(" üòä")])])}),[],!1,null,null,null);a.default=n.exports}}]);