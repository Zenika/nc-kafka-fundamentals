(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{365:function(e,a,r){"use strict";r.r(a);var t=r(44),o=Object(t.a)({},(function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"lab02-producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#lab02-producer"}},[e._v("#")]),e._v(" Lab02 - Producer")]),e._v(" "),r("h2",{attrs:{id:"rappel"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rappel"}},[e._v("#")]),e._v(" Rappel")]),e._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("img",{attrs:{src:"lab02.png",alt:"lab02"}})]),e._v(" "),r("h2",{attrs:{id:"digitransit"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#digitransit"}},[e._v("#")]),e._v(" Digitransit")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://digitransit.fi/en/developers/apis/4-realtime-api/vehicle-positions/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://digitransit.fi/en/developers/apis/4-realtime-api/vehicle-positions/"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("La plupart des v√©hicules situ√©s en "),r("strong",[e._v("Finlande üá´üáÆ")]),e._v(" produisent des √©v√©nements comprenant entre autre leurs status et\nleurs positions, une fois par seconde. Ce qui permet de facilement tracer leurs positions et de r√©aliser des exemples\nconcrets dans un environment proche IOT.")]),e._v(" "),r("p",[r("img",{attrs:{src:"digitransit.svg",alt:"digitransit"}})]),e._v(" "),r("h3",{attrs:{id:"consommation-de-la-file-mqtt-digitransit-vers-kafka"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#consommation-de-la-file-mqtt-digitransit-vers-kafka"}},[e._v("#")]),e._v(" Consommation de la file MQTT Digitransit vers Kafka")]),e._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("img",{attrs:{src:"lab02.mqtt.png",alt:"lab02.mqtt"}})]),e._v(" "),r("h2",{attrs:{id:"un-record"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#un-record"}},[e._v("#")]),e._v(" Un record")]),e._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("img",{attrs:{src:"record.png",alt:"record"}})]),e._v(" "),r("h2",{attrs:{id:"preparer-le-projet-et-le-topic-kafka"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#preparer-le-projet-et-le-topic-kafka"}},[e._v("#")]),e._v(" Pr√©parer le projet et le topic Kafka")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("‚ö†Ô∏è Checkout de la branche "),r("code",[e._v("step02")]),e._v(" ‚ö†Ô∏è.")])]),e._v(" "),r("li",[r("p",[e._v("Se placer dans le r√©pertoire "),r("code",[e._v("Lab02-producer")]),e._v(".")])]),e._v(" "),r("li",[r("p",[e._v("Cr√©er un topic "),r("code",[e._v("vehicle-positions")]),e._v(" en CLI si celui-ci n'est pas d√©j√† pr√©sent.")])])]),e._v(" "),r("blockquote",[r("p",[e._v("‚ö†Ô∏è Pensez √† √™tre pr√©sent dans le conteneur "),r("code",[e._v("tools")])])]),e._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[e._v("kafka-topics --if-not-exists --bootstrap-server kafka:9092 --create --topic vehicle-positions --replication-factor "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" --partitions "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n")])])]),r("h2",{attrs:{id:"un-peu-de-code"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#un-peu-de-code"}},[e._v("#")]),e._v(" Un peu de code")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("Au sein de ce lab nous utilisons "),r("a",{attrs:{href:"https://spring.io/projects/spring-kafka",target:"_blank",rel:"noopener noreferrer"}},[e._v("spring-kafka"),r("OutboundLink")],1),e._v(" pour dialoguer avec Kafka au\nsein de l'√©cosyst√®me Spring Boot.")])]),e._v(" "),r("li",[r("p",[e._v("Nous allons d√©couvrir sommairement, comment produire / envoyer un message √† l'aide de Spring Kafka. Pour plus de\ndocumentations :\n"),r("a",{attrs:{href:"https://docs.spring.io/spring-kafka/reference/html/#sending-messages",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.spring.io/spring-kafka/reference/html/#sending-messages"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[e._v("En effet pour produire un message vous disposez de plusieurs fa√ßons de le r√©aliser avec Spring Kafka :")]),e._v(" "),r("ul",[r("li",[e._v("en utilisant\nun "),r("code",[e._v("Producer")]),e._v(" "),r("a",{attrs:{href:"https://kafka.apache.org/26/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://kafka.apache.org/26/javadoc/index.html?org/apache/kafka/clients/producer/KafkaProducer.html"),r("OutboundLink")],1)]),e._v(" "),r("li",[e._v("en utilisant un wrapper (pour masquer une certaine\ncomplexit√©) "),r("code",[e._v("KafkaTemplate")]),e._v(" "),r("a",{attrs:{href:"https://docs.spring.io/spring-kafka/api/org/springframework/kafka/core/KafkaTemplate.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.spring.io/spring-kafka/api/org/springframework/kafka/core/KafkaTemplate.html"),r("OutboundLink")],1)])])])]),e._v(" "),r("h3",{attrs:{id:"utilisation-de-l-api-producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#utilisation-de-l-api-producer"}},[e._v("#")]),e._v(" Utilisation de l'API "),r("code",[e._v("Producer")])]),e._v(" "),r("ul",[r("li",[r("p",[e._v("Explorer le projet Spring Boot "),r("code",[e._v("Lab02-producer")])]),e._v(" "),r("ul",[r("li",[e._v("La configuration pr√©sente dans le fichier "),r("code",[e._v("application.properties")])]),e._v(" "),r("li",[e._v("L'auto-configuration de "),r("code",[e._v("ProducerFactory<String, String>")]),e._v(" en lien avec les properties")]),e._v(" "),r("li",[e._v("Le client mqtt qui r√©cup√®re les √©v√®nements\nde "),r("a",{attrs:{href:"https://digitransit.fi/en/developers/apis/4-realtime-api/vehicle-positions/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Digitransit"),r("OutboundLink")],1)])]),e._v(" "),r("blockquote",[r("p",[e._v("En effet, Spring Boot fournit une configuration automatique pour Kafka via la classe "),r("code",[e._v("KafkaAutoConfiguration")]),e._v(" ("),r("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/kafka/KafkaAutoConfiguration.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("javadoc"),r("OutboundLink")],1),e._v(")\n. Lorsque vous utilisez "),r("code",[e._v("@EnableAutoConfiguration")]),e._v(" ou "),r("code",[e._v("@SpringBootApplication")]),e._v(", Spring boot configure automatiquement Kafka pour vous."),r("br"),e._v(" "),r("code",[e._v("KafkaAutoConfiguration")]),e._v(" autoconfigure pour vous (serializer "),r("code",[e._v("String")]),e._v(" par d√©faut) les beans suivants :")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("kafkaAdmin")])]),e._v(" "),r("li",[r("code",[e._v("kafkaJaasInitializer")])]),e._v(" "),r("li",[r("code",[e._v("kafkaTransactionManager")])]),e._v(" "),r("li",[r("code",[e._v("kafkaProducerFactory")])]),e._v(" "),r("li",[r("code",[e._v("kafkaConsumerFactory")])]),e._v(" "),r("li",[r("code",[e._v("kafkaProducerListener")])]),e._v(" "),r("li",[r("code",[e._v("kafkaTemplate")])])])])]),e._v(" "),r("li",[r("p",[e._v("Compl√©ter la m√©thode "),r("code",[e._v("Subscriber#messageArrived()")]),e._v(" afin de produire des √©v√®nements")])]),e._v(" "),r("li",[r("p",[e._v("Pour un "),r("code",[e._v("Producer")]),e._v(" en mode "),r("code",[e._v("Vanilla Java")]),e._v(" vous pouvez vous inspirer de ce tutorial r√©dig√© par Confluent"),r("br"),e._v(" "),r("a",{attrs:{href:"https://kafka-tutorials.confluent.io/creating-first-apache-kafka-producer-application/kafka.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://kafka-tutorials.confluent.io/creating-first-apache-kafka-producer-application/kafka.html"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[e._v("Verifier dans AKHQ que des messages sont\nproduits "),r("a",{attrs:{href:"http://akhq:8080/ui/server/topic/vehicle-positions",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://akhq:8080/ui/server/topic/vehicle-positions"),r("OutboundLink")],1)])])]),e._v(" "),r("h3",{attrs:{id:"utilisation-de-l-api-kafkatemplate"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#utilisation-de-l-api-kafkatemplate"}},[e._v("#")]),e._v(" Utilisation de l'API "),r("code",[e._v("KafkaTemplate")])]),e._v(" "),r("ul",[r("li",[r("p",[e._v("Utilisation du profil spring "),r("code",[e._v("kafka-template")]),e._v(", plut√¥t que de s'appuyer sur le "),r("code",[e._v("kafkaProducerFactory")]),e._v(", on peut utiliser\nle bean "),r("code",[e._v("kafkaTemplate")])]),e._v(" "),r("ul",[r("li",[e._v("Le "),r("code",[e._v("KafkaTemplate")]),e._v(" wraps un producer et fournit des m√©thodes pratiques pour produire des records sur les topics\nKafka.")]),e._v(" "),r("li",[e._v("Consulter la "),r("a",{attrs:{href:"https://docs.spring.io/spring-kafka/api/org/springframework/kafka/core/KafkaTemplate.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Javadoc"),r("OutboundLink")],1),e._v("\npour plus d'informations.")])])]),e._v(" "),r("li",[r("p",[e._v("Compl√©ter la m√©thode "),r("code",[e._v("SubscriberWithTemplate#messageArrived()")]),e._v(" afin de produire des √©v√®nements")])]),e._v(" "),r("li",[r("p",[e._v("Vous pouvez vous inspirer de ce tutorial de\nBaeldung: "),r("a",{attrs:{href:"https://www.baeldung.com/spring-kafka",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.baeldung.com/spring-kafka"),r("OutboundLink")],1)])])]),e._v(" "),r("h3",{attrs:{id:"demarrer-votre-application-en-local"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#demarrer-votre-application-en-local"}},[e._v("#")]),e._v(" D√©marrer votre application en local")]),e._v(" "),r("ul",[r("li",[e._v("Il s'agit d'un projet Maven qui dispose d'un wrapper "),r("code",[e._v("mvnw")]),e._v(" et du plugin "),r("code",[e._v("spring-boot-maven-plugin")]),e._v(", vous pouvez\nd√©marrer votre application spring en local √† l'aide de la commande suivante :")])]),e._v(" "),r("blockquote",[r("p",[e._v("Se placer dans le bon r√©pertoire "),r("code",[e._v("Lab02-producer")])])]),e._v(" "),r("div",{staticClass:"language-shell extra-class"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[e._v("./mvnw spring-boot:run\n")])])]),r("h2",{attrs:{id:"packager-votre-application-avec-docker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#packager-votre-application-avec-docker"}},[e._v("#")]),e._v(" Packager votre application avec Docker")]),e._v(" "),r("ul",[r("li",[e._v("Pour builder et d√©marrer le conteneur")])]),e._v(" "),r("blockquote",[r("p",[e._v("Se placer dans le bon r√©pertoire "),r("code",[e._v("Lab02-producer")])])]),e._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[e._v("docker build -t vp-producer "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(".")]),e._v("\n")])])]),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[e._v("docker run --name vp-producer --network"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("tz-kafka-network -d vp-producer\n")])])]),r("ul",[r("li",[e._v("Pour d√©marrer votre conteneur avec le profile "),r("code",[e._v("kafka-template")])])]),e._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[e._v("docker run --name vp-producer --network"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("tz-kafka-network -e "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"SPRING_PROFILES_ACTIVE=kafka-template"')]),e._v(" -d vp-producer\n")])])]),r("blockquote",[r("p",[e._v("Supprimer le conteneur si d√©j√† pr√©sent")]),e._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[e._v("docker container stop vp-producer\ndocker container "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" vp-producer\n")])])])]),e._v(" "),r("h2",{attrs:{id:"solution"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#solution"}},[e._v("#")]),e._v(" Solution")]),e._v(" "),r("p",[e._v("Vous vous doutez que pour disposer des solutions de la "),r("code",[e._v("step02")]),e._v(", il vous suffit deÔ∏è checkout la branche "),r("code",[e._v("step03")]),e._v(" üòä")])])}),[],!1,null,null,null);a.default=o.exports}}]);